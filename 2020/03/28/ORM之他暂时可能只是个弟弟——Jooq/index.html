<!DOCTYPE html>
<html lang='en'>

<head>
  <meta name="generator" content="Hexo 5.4.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>ORM之他暂时可能只是个弟弟——Jooq - Hexo</title>

  
    <meta name="description" content="摘要：这篇文章主要是对之前一段时间学习Jooq的总结。 前言：相比较Hibernate、Mybatis等大家早已熟知的ORM框架来说，JOOQ只能算是一个弟弟。但它之所以能够脱颖而出，是因为它找到了正确的设计思想。 Jooq简介JOOQ 是基于Java访问关系型数据库的工具包，轻量，简单，并且足够灵活，可以轻松的使用Java面向对象语法来实现各种复杂的sql。不管是Hibernate或者Mybat">
<meta property="og:type" content="article">
<meta property="og:title" content="ORM之他暂时可能只是个弟弟——Jooq">
<meta property="og:url" content="http://example.com/2020/03/28/ORM%E4%B9%8B%E4%BB%96%E6%9A%82%E6%97%B6%E5%8F%AF%E8%83%BD%E5%8F%AA%E6%98%AF%E4%B8%AA%E5%BC%9F%E5%BC%9F%E2%80%94%E2%80%94Jooq/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="摘要：这篇文章主要是对之前一段时间学习Jooq的总结。 前言：相比较Hibernate、Mybatis等大家早已熟知的ORM框架来说，JOOQ只能算是一个弟弟。但它之所以能够脱颖而出，是因为它找到了正确的设计思想。 Jooq简介JOOQ 是基于Java访问关系型数据库的工具包，轻量，简单，并且足够灵活，可以轻松的使用Java面向对象语法来实现各种复杂的sql。不管是Hibernate或者Mybat">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-28T07:32:00.031Z">
<meta property="article:modified_time" content="2020-03-10T07:13:02.089Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="ORM">
<meta property="article:tag" content="Jooq">
<meta name="twitter:card" content="summary">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
</head>

<body>
  


  <div class='l_body' id='start'>
    <aside class='l_left'>
    

<header class='header'>
  <div class='logo-wrap'>
  
  
    <a class='title' href='/'>
      Hexo
    </a>
  
</div>

  <nav class="menu dis-select"></nav>
</header>

<div class='widgets'>
  
    
      
      
<div class="widget-wrap" id="toc"><div class="widget-header h4 dis-select"><span class="name">TOC</span></div><div class="widget-body fs14 post"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Jooq%E7%AE%80%E4%BB%8B"><span class="toc-text">Jooq简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BJooq"><span class="toc-text">快速上手Jooq</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E4%B8%8B%E8%BD%BDJOOQ"><span class="toc-text">第一步 下载JOOQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">第二步 创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81"><span class="toc-text">第三步 生成代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E3%80%81%E4%BA%94%E3%80%81%E5%85%AD%E6%AD%A5-%E5%AE%8C%E6%88%90%E5%A2%9E%E5%88%A0%E6%94%B9%E6%93%8D%E4%BD%9C"><span class="toc-text">第四、五、六步 完成增删改操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2-%EF%BC%9A%E7%95%A5"><span class="toc-text">探索 ：略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-text">特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%94%9F%E6%88%90POJO"><span class="toc-text">1、生成POJO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3"><span class="toc-text">2、生成接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%94%9F%E6%88%90Annotation"><span class="toc-text">3、生成Annotation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81Builder%E6%A8%A1%E5%BC%8F"><span class="toc-text">4、Builder模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81DAO%E5%92%8Cspring"><span class="toc-text">5、DAO和spring</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="toc-text">6、无符号数字类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E4%B9%90%E8%A7%82%E9%94%81%E6%94%AF%E6%8C%81"><span class="toc-text">7、乐观锁支持</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90"><span class="toc-text">应用集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JOOQ%E4%B8%8Ehikaricp%E9%9B%86%E6%88%90%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">JOOQ与hikaricp集成管理数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85"><span class="toc-text">观察者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93"><span class="toc-text">分库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B"><span class="toc-text">复用数据库实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text">依赖注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%EF%BC%9ABatch%E3%80%81Curser%E3%80%81Transaction"><span class="toc-text">其他常用操作：Batch、Curser、Transaction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E8%BF%90%E8%A1%8C%E6%97%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">其它运行时配置</span></a></li></ol></li></ol></div></div></div>

    
  
</div>


    </aside>
    <div class='l_main'>
      

      


  <div class='bread-nav fs12'>
  
    
    <div id='breadcrumb'>
      <a class='cap breadcrumb' href='/'>Home</a>
      <span class="sep"></span>
      <a class='cap breadcrumb' href='/'>Blog</a>
      
        <span class="sep"></span>
        <a class="cap breadcrumb-link" href="/categories/ORM/">ORM</a>
      
    </div>
    <div id='post-meta'>
      Posted on&nbsp;<time datetime='2020-03-28T07:32:00.031Z'>2020-03-28</time>
    </div>
  
  </div>


<article class='content md post'>
<h1 class="article-title"><span>ORM之他暂时可能只是个弟弟——Jooq</span></h1>
<h1 id="摘要：这篇文章主要是对之前一段时间学习Jooq的总结。"><a href="#摘要：这篇文章主要是对之前一段时间学习Jooq的总结。" class="headerlink" title="摘要：这篇文章主要是对之前一段时间学习Jooq的总结。"></a>摘要：这篇文章主要是对之前一段时间学习Jooq的总结。</h1><hr>
<h1 id="前言：相比较Hibernate、Mybatis等大家早已熟知的ORM框架来说，JOOQ只能算是一个弟弟。但它之所以能够脱颖而出，是因为它找到了正确的设计思想。"><a href="#前言：相比较Hibernate、Mybatis等大家早已熟知的ORM框架来说，JOOQ只能算是一个弟弟。但它之所以能够脱颖而出，是因为它找到了正确的设计思想。" class="headerlink" title="前言：相比较Hibernate、Mybatis等大家早已熟知的ORM框架来说，JOOQ只能算是一个弟弟。但它之所以能够脱颖而出，是因为它找到了正确的设计思想。"></a>前言：相比较Hibernate、Mybatis等大家早已熟知的ORM框架来说，JOOQ只能算是一个弟弟。但它之所以能够脱颖而出，是因为它找到了正确的设计思想。</h1><hr>
<h2 id="Jooq简介"><a href="#Jooq简介" class="headerlink" title="Jooq简介"></a>Jooq简介</h2><p>JOOQ 是基于Java访问关系型数据库的工具包，轻量，简单，并且足够灵活，可以轻松的使用Java面向对象语法来实现各种复杂的sql。不管是Hibernate或者Mybatis，都能简单的使用实体映射来访问数据库，但有时候这些“高级”的对象关系映射，没有直接使用原生sql来的灵活和简单，而且对于一些如：joins,union, nested selects等复杂的操作支持的不友好。JOOQ 既吸取了传统ORM操作数据的简单性和安全性，又保留了原生sql的灵活性，它更像是介于ORM和JDBC的中间层。</p>
<p>相比其它ORM，JOOQ更注重于对<a target="_blank" rel="noopener" href="http://stackoverflow.com/a/4208156/851099">数据库模型的建模</a>。它拥有以下特点：</p>
<ul>
<li>面向SQL</li>
<li>构建类型安全的SQL</li>
<li>强大的代码生成工具</li>
<li>方便的乐观锁等高级特性</li>
</ul>
<p>详细的可以看看<a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual-single-page/#preface">Jooq官网介绍</a>。</p>
<p>如果说它有什么缺点，那就是它对一些商用数据库，如Oracle、SQL Server是收费的。</p>
<h2 id="快速上手Jooq"><a href="#快速上手Jooq" class="headerlink" title="快速上手Jooq"></a>快速上手Jooq</h2><p>接下来，让我们通过官网的<a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual-single-page/#jooq-in-7-steps">《JOOQ7步走》</a>中的例子快速上手JOOQ吧。</p>
<h3 id="第一步-下载JOOQ"><a href="#第一步-下载JOOQ" class="headerlink" title="第一步 下载JOOQ"></a>第一步 下载JOOQ</h3><p>首先需要在JOOQ的<a target="_blank" rel="noopener" href="http://www.jooq.org/download">下载页面</a>下载它。如果使用的是开源版本，可以直接通过Maven等工具下载。</p>
<h3 id="第二步-创建数据库"><a href="#第二步-创建数据库" class="headerlink" title="第二步 创建数据库"></a>第二步 创建数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &#96;test&#96;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;student&#96; (</span><br><span class="line">  &#96;id&#96; int(10) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;stu_id&#96; int(20) NOT NULL,</span><br><span class="line">  &#96;stu_name&#96; varchar(40) NOT NULL,</span><br><span class="line">  &#96;age&#96; int(8) DEFAULT NULL,</span><br><span class="line">  &#96;class_id&#96; int(10) NOT NULL,</span><br><span class="line">  &#96;class_name&#96; varchar(40) NOT NULL,</span><br><span class="line">  &#96;result&#96; int(8) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1 DEFAULT CHARSET&#x3D;utf8mb4;</span><br></pre></td></tr></table></figure>

<h3 id="第三步-生成代码"><a href="#第三步-生成代码" class="headerlink" title="第三步 生成代码"></a>第三步 生成代码</h3><p>JOOQ生成代码方式有多种，可以按照<a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual-single-page/#jooq-in-7-steps-step3">官网的方法</a>生成代码。然后就可以在自己的代码中使用这些生成的代码了。</p>
<p>或者参考下面配置，修改你的pom.xml，然后在Terminal运行：mvn jooq-codegen:generate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;!-- 数据库信息 --&gt;</span><br><span class="line">    &lt;db.url&gt;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&lt;&#x2F;db.url&gt;</span><br><span class="line">    &lt;!-- 你的数据库用户名 --&gt;</span><br><span class="line">    &lt;db.username&gt;root&lt;&#x2F;db.username&gt;</span><br><span class="line">    &lt;!-- 你的数据库密码 --&gt;</span><br><span class="line">    &lt;db.password&gt;&#123;*********&#125;&lt;&#x2F;db.password&gt;</span><br><span class="line">    &lt;jooq.version&gt;3.13.1&lt;&#x2F;jooq.version&gt;</span><br><span class="line">    &lt;!-- 你的packageName --&gt;</span><br><span class="line">    &lt;jooq.packageName&gt;&#123;*********&#125;&lt;&#x2F;jooq.packageName&gt;</span><br><span class="line">    &lt;!-- 你的directory --&gt;</span><br><span class="line">    &lt;jooq.directory&gt;&#123;*********&#125;&lt;&#x2F;jooq.directory&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">&lt;!-- jOOQ代码生成插件 --&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.jooq&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;jooq-codegen-maven&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.11.2&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;jooq-codegen&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;generate&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;skip&gt;false&lt;&#x2F;skip&gt;</span><br><span class="line">                    &lt;jdbc&gt;</span><br><span class="line">                        &lt;driver&gt;com.mysql.jdbc.Driver&lt;&#x2F;driver&gt;</span><br><span class="line">                        &lt;url&gt;$&#123;db.url&#125;&lt;&#x2F;url&gt;</span><br><span class="line">                        &lt;user&gt;$&#123;db.username&#125;&lt;&#x2F;user&gt;</span><br><span class="line">                        &lt;password&gt;$&#123;db.password&#125;&lt;&#x2F;password&gt;</span><br><span class="line">                    &lt;&#x2F;jdbc&gt;</span><br><span class="line">                    &lt;generator&gt;</span><br><span class="line">                        &lt;name&gt;org.jooq.codegen.JavaGenerator&lt;&#x2F;name&gt;</span><br><span class="line">                        &lt;database&gt;</span><br><span class="line">                            &lt;name&gt;org.jooq.meta.mysql.MySQLDatabase&lt;&#x2F;name&gt;</span><br><span class="line">                            &lt;includes&gt;.*&lt;&#x2F;includes&gt;</span><br><span class="line">                            &lt;excludes&gt;&lt;&#x2F;excludes&gt;</span><br><span class="line">                            &lt;inputSchema&gt;test&lt;&#x2F;inputSchema&gt;</span><br><span class="line">                        &lt;&#x2F;database&gt;</span><br><span class="line">                        &lt;generate&gt;</span><br><span class="line">                            &lt;javaTimeTypes&gt;true&lt;&#x2F;javaTimeTypes&gt;</span><br><span class="line">                        &lt;&#x2F;generate&gt;</span><br><span class="line">                        &lt;target&gt;</span><br><span class="line">                            &lt;!-- The destination package of your generated classes (within the</span><br><span class="line">                                destination directory) --&gt;</span><br><span class="line">                            &lt;packageName&gt;$&#123;jooq.packageName&#125;&lt;&#x2F;packageName&gt;</span><br><span class="line">                            &lt;!-- The destination directory of your generated classes --&gt;</span><br><span class="line">                            &lt;directory&gt;$&#123;jooq.directory&#125;&lt;&#x2F;directory&gt;</span><br><span class="line">                        &lt;&#x2F;target&gt;</span><br><span class="line">                        &lt;generate&gt;</span><br><span class="line">                            &lt;!-- 生成pojo --&gt;</span><br><span class="line">                            &lt;pojos&gt;true&lt;&#x2F;pojos&gt;</span><br><span class="line">                            &lt;!-- 生成dao --&gt;</span><br><span class="line">                            &lt;daos&gt;true&lt;&#x2F;daos&gt;</span><br><span class="line">                        &lt;&#x2F;generate&gt;</span><br><span class="line">                    &lt;&#x2F;generator&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">      &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第四、五、六步-完成增删改操作"><a href="#第四、五、六步-完成增删改操作" class="headerlink" title="第四、五、六步 完成增删改操作"></a>第四、五、六步 完成增删改操作</h3><p>具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">import org.jooq.DSLContext;</span><br><span class="line">import org.jooq.Record;</span><br><span class="line">import org.jooq.Result;</span><br><span class="line">import org.jooq.SQLDialect;</span><br><span class="line">import org.jooq.impl.DSL;</span><br><span class="line">import top.ajie.jooqDemo.entity.tables.Student;</span><br><span class="line">import top.ajie.jooqDemo.entity.tables.records.StudentRecord;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line">import static top.ajie.jooqDemo.entity.Tables.STUDENT;</span><br><span class="line"></span><br><span class="line">public class JooqCRUD &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        String userName &#x3D; &quot;root&quot;;</span><br><span class="line">        String password &#x3D; &quot;&quot;;</span><br><span class="line">        String url &#x3D; &quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;test?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&quot;;</span><br><span class="line">        &#x2F;&#x2F; Connection is the only JDBC resource that we need</span><br><span class="line">        &#x2F;&#x2F; PreparedStatement and ResultSet are handled by jOOQ, internally</span><br><span class="line">        try (Connection conn &#x3D; DriverManager.getConnection(url, userName, password)) &#123;</span><br><span class="line">            DSLContext dslContext &#x3D; DSL.using(conn, SQLDialect.MYSQL);</span><br><span class="line">            &#x2F;&#x2F; 查询数据</span><br><span class="line">            query(dslContext);</span><br><span class="line">            &#x2F;&#x2F; 添加数据</span><br><span class="line">            StudentRecord stu &#x3D; dslContext.newRecord(STUDENT);</span><br><span class="line">            stu.setStuId(123456);</span><br><span class="line">            stu.setStuName(&quot;张三&quot;);</span><br><span class="line">            stu.setClassId(20200306);</span><br><span class="line">            stu.setClassName(&quot;三年六班&quot;);</span><br><span class="line">            stu.setAge(9);</span><br><span class="line">            stu.setResult(100);</span><br><span class="line">            stu.store();</span><br><span class="line">            &#x2F;&#x2F; 查询数据</span><br><span class="line">            query(dslContext);</span><br><span class="line">            &#x2F;&#x2F; 修改数据</span><br><span class="line">            int sumUp &#x3D; dslContext</span><br><span class="line">                    .update(Student.STUDENT)</span><br><span class="line">                    .set(Student.STUDENT.STU_NAME, &quot;李四&quot;)</span><br><span class="line">                    .where(Student.STUDENT.STU_NAME.eq(&quot;张三&quot;)</span><br><span class="line">                            .and(Student.STUDENT.RESULT.eq(100))</span><br><span class="line">                    )</span><br><span class="line">                    .execute();</span><br><span class="line">            System.out.println(sumUp);</span><br><span class="line">            &#x2F;&#x2F; 查询数据</span><br><span class="line">            query(dslContext);</span><br><span class="line">            &#x2F;&#x2F; 删除数据</span><br><span class="line">            int sumDelete &#x3D; dslContext</span><br><span class="line">                    .delete(Student.STUDENT)</span><br><span class="line">                    .where(Student.STUDENT.STU_NAME.eq(&quot;李四&quot;)</span><br><span class="line">                            .and(Student.STUDENT.RESULT.eq(100))</span><br><span class="line">                    )</span><br><span class="line">                    .execute();</span><br><span class="line">            System.out.println(sumDelete);</span><br><span class="line">            &#x2F;&#x2F; 查询数据</span><br><span class="line">            query(dslContext);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; For the sake of this tutorial, let&#39;s keep exception handling simple</span><br><span class="line">        catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void query(DSLContext dslContext) &#123;</span><br><span class="line">        &#x2F;&#x2F; 查询数据</span><br><span class="line">        Result&lt;Record&gt; stuResult &#x3D; dslContext.select().from(STUDENT).fetch();</span><br><span class="line">        for (Record r : stuResult) &#123;</span><br><span class="line">            String stuName &#x3D; r.getValue(STUDENT.STU_NAME);</span><br><span class="line">            String className &#x3D; r.getValue(STUDENT.CLASS_NAME);</span><br><span class="line">            Integer result &#x3D; r.getValue(STUDENT.RESULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;stuName: &quot; + stuName + &quot; className: &quot; + className + &quot; result: &quot; + result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="探索-：略"><a href="#探索-：略" class="headerlink" title="探索 ：略"></a>探索 ：略</h3><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><h3 id="1、生成POJO"><a href="#1、生成POJO" class="headerlink" title="1、生成POJO"></a>1、生成POJO</h3><p>首先在生成配置中添加生成POJO的选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;generate&gt;</span><br><span class="line">  &lt;pojos&gt;true&lt;&#x2F;pojos&gt;</span><br><span class="line">&lt;&#x2F;generate&gt;</span><br></pre></td></tr></table></figure>

<p>重新运行生成工具，一个 student 类就生成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Generated;</span><br><span class="line"></span><br><span class="line">@SuppressWarnings(&#123; &quot;all&quot;, &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span><br><span class="line">public class Student implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID &#x3D; -1386674258;</span><br><span class="line"></span><br><span class="line">    private Integer id;</span><br><span class="line">    private Integer stuId;</span><br><span class="line">    private String  stuName;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private Integer classId;</span><br><span class="line">    private String  className;</span><br><span class="line">    private Integer result;</span><br><span class="line"></span><br><span class="line">    public Student() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    public Student(Student value) &#123;</span><br><span class="line">        this.id &#x3D; value.id;</span><br><span class="line">        this.stuId &#x3D; value.stuId;</span><br><span class="line">        this.stuName &#x3D; value.stuName;</span><br><span class="line">        this.age &#x3D; value.age;</span><br><span class="line">        this.classId &#x3D; value.classId;</span><br><span class="line">        this.className &#x3D; value.className;</span><br><span class="line">        this.result &#x3D; value.result;</span><br><span class="line">    &#125;</span><br><span class="line">    ............</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后可以使用JOOQ的API方便的将查询结果和POJO相互转化了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Record to POJO</span><br><span class="line">List&lt;Student&gt; list &#x3D; dslContext.selectFrom(STUDENT).fetch().into(Student.class);</span><br><span class="line">System.out.println(list);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; POJO to Record</span><br><span class="line">Student a &#x3D; dslContext.selectFrom(STUDENT).fetch().get(0).into(Student.class);</span><br><span class="line">StudentRecord author &#x3D; dslContext.newRecord(STUDENT);</span><br><span class="line">author.from(a);</span><br><span class="line">System.out.println(author);</span><br></pre></td></tr></table></figure>

<p>需要注意的是：</p>
<ul>
<li><code>from</code>方法提供了多个重载，可以从<code>Map</code>或<code>Array</code>获取数据</li>
<li><code>from</code>方法从<code>Object</code>获取数据使用了反射的方式，因此效率会比较低。【后面会有解决办法】</li>
</ul>
<h3 id="2、生成接口"><a href="#2、生成接口" class="headerlink" title="2、生成接口"></a>2、生成接口</h3><p>Java提倡面向接口编程，JOOQ也提供了生成接口的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;generate&gt;</span><br><span class="line">  &lt;interfaces&gt;true&lt;&#x2F;interfaces&gt;</span><br><span class="line">&lt;&#x2F;generate&gt;</span><br></pre></td></tr></table></figure>

<p>生成的接口是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Generated;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * This class is generated by jOOQ.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Generated(</span><br><span class="line">    value &#x3D; &#123;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;www.jooq.org&quot;,</span><br><span class="line">        &quot;jOOQ version:3.11.11&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    comments &#x3D; &quot;This class is generated by jOOQ&quot;</span><br><span class="line">)</span><br><span class="line">@SuppressWarnings(&#123; &quot;all&quot;, &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span><br><span class="line">public interface IStudent extends Serializable &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Setter for &lt;code&gt;test.student.id&lt;&#x2F;code&gt;.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void setId(Integer value);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Getter for &lt;code&gt;test.student.id&lt;&#x2F;code&gt;.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Integer getId();</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Copy data into another generated Record&#x2F;POJO implementing the common interface IStudent</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public &lt;E extends top.ajie.jooqDemo.entity.tables.interfaces.IStudent&gt; E into(E into);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果选择生成“接口”，则生成的Record和POJO都将继承该接口。<br>而之前提到的from方法也将会增加一个IStudent的重载，并使用其中的Getters, Setters，从而具有更好的性能。</p>
<p>如果只生成接口，而不生成Record或POJO，则JOOQ会使用proxy动态代理对象的方法来达到相同的效果。</p>
<h3 id="3、生成Annotation"><a href="#3、生成Annotation" class="headerlink" title="3、生成Annotation"></a>3、生成Annotation</h3><p>JOOQ可以选择生成JPA和JSR-303的注解，从而能够更好的和JPA框架配合，并提供更加强大的校验能力：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;jpaAnnotations&gt;true&lt;&#x2F;jpaAnnotations&gt;</span><br><span class="line">&lt;validationAnnotations&gt;true&lt;&#x2F;validationAnnotations&gt;</span><br></pre></td></tr></table></figure>

<p>选择之后，以<code>IStudent</code>为例，生成的代码将变成这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Generated;</span><br><span class="line">import javax.persistence.Column;</span><br><span class="line">import javax.persistence.Entity;</span><br><span class="line">import javax.persistence.GeneratedValue;</span><br><span class="line">import javax.persistence.GenerationType;</span><br><span class="line">import javax.persistence.Id;</span><br><span class="line">import javax.persistence.Index;</span><br><span class="line">import javax.persistence.Table;</span><br><span class="line">import javax.validation.constraints.NotNull;</span><br><span class="line">import javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * This class is generated by jOOQ.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Generated(</span><br><span class="line">    value &#x3D; &#123;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;www.jooq.org&quot;,</span><br><span class="line">        &quot;jOOQ version:3.11.11&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    comments &#x3D; &quot;This class is generated by jOOQ&quot;</span><br><span class="line">)</span><br><span class="line">@SuppressWarnings(&#123; &quot;all&quot;, &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span><br><span class="line">@Entity</span><br><span class="line">@Table(name &#x3D; &quot;student&quot;, schema &#x3D; &quot;test&quot;, indexes &#x3D; &#123;</span><br><span class="line">    @Index(name &#x3D; &quot;PRIMARY&quot;, unique &#x3D; true, columnList &#x3D; &quot;id ASC&quot;)</span><br><span class="line">&#125;)</span><br><span class="line">public interface IStudent extends Serializable &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Setter for &lt;code&gt;test.student.id&lt;&#x2F;code&gt;.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void setId(Integer value);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Getter for &lt;code&gt;test.student.id&lt;&#x2F;code&gt;.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy &#x3D; GenerationType.IDENTITY)</span><br><span class="line">    @Column(name &#x3D; &quot;id&quot;, unique &#x3D; true, nullable &#x3D; false, precision &#x3D; 10)</span><br><span class="line">    public Integer getId();</span><br><span class="line"></span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Copy data into another generated Record&#x2F;POJO implementing the common interface IStudent</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public &lt;E extends top.ajie.jooqDemo.entity.tables.interfaces.IStudent&gt; E into(E into);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4、Builder模式"><a href="#4、Builder模式" class="headerlink" title="4、Builder模式"></a>4、Builder模式</h3><p>到了这一步，也许你已经在问自己，为什么没有早点认识JOOQ了，能省不少事呢。不过你知道吗，JOOQ还可以做得更多——它能生成具有Builder模式的Bean：</p>
<p>添加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;generate&gt;</span><br><span class="line">  &lt;fluentSetters&gt;true&lt;&#x2F;fluentSetters&gt;</span><br><span class="line">&lt;&#x2F;generate&gt;</span><br></pre></td></tr></table></figure>

<p>配置fluentSetters为true时，Setter将返回自身：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public Student setId(Integer id) &#123;</span><br><span class="line">    this.id &#x3D; id;</span><br><span class="line">    return this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成的代码将可以这样使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IStudent student &#x3D; dslContext.newRecord(STUDENT);</span><br><span class="line">student.setId(1).setStuId(123456).setStuName(&quot;老六&quot;);</span><br></pre></td></tr></table></figure>

<p>这样代码字段设置和之前相比简洁了很多。</p>
<h3 id="5、DAO和spring"><a href="#5、DAO和spring" class="headerlink" title="5、DAO和spring"></a>5、DAO和spring</h3><p>如果你是DAO模式和Spring的忠实粉丝，还可以增加以下两个配置，无缝对接Spring的集成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;daos&gt;true&lt;&#x2F;daos&gt;</span><br><span class="line">&lt;springAnnotations&gt;true&lt;&#x2F;springAnnotations&gt;</span><br></pre></td></tr></table></figure>

<p>生成的代码类似这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Generated;</span><br><span class="line"></span><br><span class="line">import org.jooq.Configuration;</span><br><span class="line">import org.jooq.impl.DAOImpl;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">import top.ajie.jooqDemo.entity.tables.Student;</span><br><span class="line">import top.ajie.jooqDemo.entity.tables.records.StudentRecord;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * This class is generated by jOOQ.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Generated(</span><br><span class="line">    value &#x3D; &#123;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;www.jooq.org&quot;,</span><br><span class="line">        &quot;jOOQ version:3.11.11&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    comments &#x3D; &quot;This class is generated by jOOQ&quot;</span><br><span class="line">)</span><br><span class="line">@SuppressWarnings(&#123; &quot;all&quot;, &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span><br><span class="line">@Repository</span><br><span class="line">public class StudentDao extends DAOImpl&lt;StudentRecord, top.ajie.jooqDemo.entity.tables.pojos.Student, Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Create a new StudentDao without any configuration</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public StudentDao() &#123;</span><br><span class="line">        super(Student.STUDENT, top.ajie.jooqDemo.entity.tables.pojos.Student.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Create a new StudentDao with an attached configuration</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Autowired</span><br><span class="line">    public StudentDao(Configuration configuration) &#123;</span><br><span class="line">        super(Student.STUDENT, top.ajie.jooqDemo.entity.tables.pojos.Student.class, configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Fetch records that have &lt;code&gt;result IN (values)&lt;&#x2F;code&gt;</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public List&lt;top.ajie.jooqDemo.entity.tables.pojos.Student&gt; fetchByResult(Integer... values) &#123;</span><br><span class="line">        return fetch(Student.STUDENT.RESULT, values);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、无符号数字类型"><a href="#6、无符号数字类型" class="headerlink" title="6、无符号数字类型"></a>6、无符号数字类型</h3><p>SQL支持无符号数字，但是java没有内建无符号数字的类型，为此JOOQ的作者提供了JOOU来处理无符号数。</p>
<p>例如对上面的age字段，类型可以设置成UInteger，可以使用age.intValue()获取对应的int数值。尽管UInteger更加准确，但是如果你觉得增加一个intValue()的调用会比较繁琐。可以通过下面这个配置使POJO直接使用int作为字段类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;database&gt;</span><br><span class="line">  &lt;unsignedTypes&gt;false&lt;&#x2F;unsignedTypes&gt;</span><br><span class="line">&lt;&#x2F;database&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7、乐观锁支持"><a href="#7、乐观锁支持" class="headerlink" title="7、乐观锁支持"></a>7、乐观锁支持</h3><p>一个修改的常见场景是：用户读取了记录，作了修改之后再保存入数据库。如果这个时间里，有人修改了数据库的同一个字段，则上一个人的修改就被覆盖了。</p>
<p>乐观锁就是再出现这种情况时，通过抛出异常或其他方式，来提醒用户改动不安全，需要刷新并重新修改记录。</p>
<p>jOOQ允许您使用乐观锁定执行CRUD操作。您可以通过激活相关的<a target="_blank" rel="noopener" href="https://www.jooq.org/doc/3.8/manual/sql-building/dsl-context/custom-settings/">executeWithOptimisticLocking</a>设置立即利用此功能。如果不进一步了解基础数据语义，这将对store()和delete()方法产生以下影响：</p>
<ul>
<li>INSERT语句不受此Setting标志的影响。</li>
<li>在UPDATE或DELETE语句之前，jOOQ将运行SELECT .. FOR UPDATE语句，悲观地锁定记录以用于后续的UPDATE(DELETE)。</li>
<li>使用先前的SELECT提取的数据将与存储或删除的记录中的数据进行比较。</li>
<li>一个org.jooq.exception.DataChangedException如果记录已经在平均时间被修改，则被抛出。</li>
<li>如果同时未修改记录，则记录成功UPDATE(DELETE)。</li>
</ul>
<p>JOOQ提供了一个配置能方便地实现乐观锁，而不需要修改业务代码【详见<a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual/sql-execution/crud-with-updatablerecords/optimistic-locking/">文档</a>】：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Properly configure the DSLContext</span><br><span class="line">DSLContext optimistic &#x3D; DSLContext.using(connection, SQLDialect.MYSQL,</span><br><span class="line">  new Settings().withExecuteWithOptimisticLocking(true));</span><br></pre></td></tr></table></figure>

<p>JOOQ的乐观锁模式虽然对业务逻辑代码没有侵入性，但是需要数据表提供<code>numeric VERSION</code>或<code>TIMESTAMP</code>字段，比如下表的<code>last_modified_time</code>字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;student&#96; (</span><br><span class="line">  &#96;id&#96; int(10) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;stu_id&#96; int(20) NOT NULL,</span><br><span class="line">  &#96;stu_name&#96; varchar(40) NOT NULL,</span><br><span class="line">  &#96;age&#96; int(8) DEFAULT NULL,</span><br><span class="line">  &#96;class_id&#96; int(10) NOT NULL,</span><br><span class="line">  &#96;class_name&#96; varchar(40) NOT NULL,</span><br><span class="line">  &#96;result&#96; int(8) DEFAULT NULL,</span><br><span class="line">  &#96;time&#96; timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP(0),</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1 DEFAULT CHARSET&#x3D;utf8mb4;</span><br></pre></td></tr></table></figure>

<p>然后在代码生成中添加下面的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;database&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;!-- 支持正则，多个字段可以使用&#96;|&#96;分隔 --&gt;</span><br><span class="line">  &lt;recordTimestampFields&gt;last_modified_time&lt;&#x2F;recordTimestampFields&gt;</span><br><span class="line">&lt;&#x2F;database&gt;</span><br></pre></td></tr></table></figure>

<p>最后生成的<code>Table</code>类中将增加一个<code>getRecordTimestamp</code>方法供乐观锁使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public TableField&lt;StudentRecord, Timestamp&gt; getRecordTimestamp() &#123;</span><br><span class="line">    return TIME;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="应用集成"><a href="#应用集成" class="headerlink" title="应用集成"></a>应用集成</h2><h3 id="JOOQ与hikaricp集成管理数据源"><a href="#JOOQ与hikaricp集成管理数据源" class="headerlink" title="JOOQ与hikaricp集成管理数据源"></a>JOOQ与hikaricp集成管理数据源</h3><p>JOOQ唯一的外部依赖就是一个JDBC连接或JDBC资源池<code>DataSource</code>。JOOQ只会使用这个连接构建<code>PreparedStatement</code>和执行SQL，并不会管理这个连接的生命周期。这样做的好处是模块功能划分做的很彻底，数据源的事情由专门的数据源库来管理<code>DataSource</code>是一个独立的模块，我们可以灵活地配置它。</p>
<p>应用开发需要引入一个第三方的<code>DatatSource</code>数据源来管理数据库连接；这里介绍一下<a target="_blank" rel="noopener" href="https://github.com/brettwooldridge/HikariCP">hikaricp</a>的集成方式：</p>
<p>Hikari提供了<a target="_blank" rel="noopener" href="https://github.com/brettwooldridge/HikariCP#initialization">多种方式</a>创建数据源，例如可以程序直接创建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HikariConfig config &#x3D; new HikariConfig();</span><br><span class="line">config.setJdbcUrl(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;test&quot;);</span><br><span class="line">config.setUsername(&quot;root&quot;);</span><br><span class="line">config.setPassword(&quot;123456&quot;);</span><br><span class="line">config.addDataSourceProperty(&quot;cachePrepStmts&quot;, &quot;true&quot;);</span><br><span class="line">config.addDataSourceProperty(&quot;prepStmtCacheSize&quot;, &quot;350&quot;);</span><br><span class="line">config.addDataSourceProperty(&quot;prepStmtCacheSqlLimit&quot;, &quot;2048&quot;);</span><br><span class="line"></span><br><span class="line">HikariDataSource ds &#x3D; new HikariDataSource(config);</span><br><span class="line">DSLContext create &#x3D; DSL.using(ds, SQLDialect.MYSQL);</span><br></pre></td></tr></table></figure>

<h3 id="观察者"><a href="#观察者" class="headerlink" title="观察者"></a>观察者</h3><p>ExecuteListener 可以看作是一个JOOQ执行的观察者，它可以监控SQL执行的整个生命周期。并且可以通过执行上下文，做一些个性化的操作。下面SlowQueryListener类的作用就是收集sql执行过程的慢查询日志。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">class SlowQueryListener extends DefaultExecuteListener &#123;</span><br><span class="line">  private Logger logger &#x3D; LoggerFactory.getLogger(SlowQueryListener.class);</span><br><span class="line">  StopWatch watch;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void executeStart(ExecuteContext ctx) &#123;</span><br><span class="line">    super.executeStart(ctx);</span><br><span class="line">    watch &#x3D; new StopWatch();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void executeEnd(ExecuteContext ctx) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">      super.executeEnd(ctx);</span><br><span class="line">      if (watch.split() &gt; 1_000_000_000L) &#123;&#x2F;&#x2F;记录执行时间超过1s的操作</span><br><span class="line">        ExecuteType type &#x3D; ctx.type();</span><br><span class="line">        StringBuffer sqlBuffer &#x3D; new StringBuffer();</span><br><span class="line">        if(type &#x3D;&#x3D; ExecuteType.BATCH) &#123;</span><br><span class="line">          for(Query query:ctx.batchQueries()) &#123;</span><br><span class="line">            sqlBuffer.append(query.toString()).append(&quot;\n&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">          sqlBuffer.append(ctx.query() &#x3D;&#x3D; null ? &quot;blank query &quot;:ctx.query().toString());</span><br><span class="line">        &#125;</span><br><span class="line">        watch.splitInfo(String.format(&quot;Slow SQL query meta executed : [ %s ]&quot;,</span><br><span class="line">                                      sqlBuffer.toString() ));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;catch (Exception e) &#123;</span><br><span class="line">      logger.error(&quot; SlowQueryListener has occur,fix bug  &quot;,e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在初始化 DSLContext 的时候把SlowQueryListener配置进去，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dslContext.configuration()</span><br><span class="line">                .set(DefaultExecuteListenerProvider.providers(slowQueryListener));</span><br></pre></td></tr></table></figure>

<h3 id="分库"><a href="#分库" class="headerlink" title="分库"></a>分库</h3><p>数据库分库是生产环境中经常使用的方式，例如我们提供了一个新的<code>class</code>的库，复用了<code>student</code>表。如果我们要查询<code>class</code>库，还需要重新生成<code>class</code>的代码，那就太麻烦了。JOOQ提供了运行时替换库名的能力，使得在生产环境中使用多个分库变得很轻松。还以<code>student</code>的查询为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DSLContext dsl &#x3D; DSL.using(conn, SQLDialect.MYSQL);</span><br><span class="line">List&lt;Student&gt; list &#x3D; dslContext.selectFrom(STUDENT).fetch();</span><br></pre></td></tr></table></figure>

<p>对应的默认查询语句是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;id&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;stu_id&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;stu_name&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;age&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;class_id&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;class_name&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;result&#96;,</span><br><span class="line">&#96;test&#96;.&#96;student&#96;.&#96;time&#96;</span><br><span class="line">from &#96;test&#96;.&#96;student&#96;</span><br></pre></td></tr></table></figure>

<p>如果我们配置了动态替换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Settings settings &#x3D;</span><br><span class="line">        new Settings().withRenderMapping(new RenderMapping().withSchemata(</span><br><span class="line">                new MappedSchema().withInput(&quot;test&quot;).withOutput(&quot;class&quot;)));</span><br><span class="line">DSLContext dsl &#x3D; DSL.using(dataSource, SQLDialect.MYSQL, settings);</span><br><span class="line">List&lt;Student&gt; list &#x3D; dsl.selectFrom(STUDENT).fetch();</span><br></pre></td></tr></table></figure>

<p>则生成的语句就变为<code>class</code>下的SQL了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;id&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;stu_id&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;stu_name&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;age&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;class_id&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;class_name&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;result&#96;,</span><br><span class="line">&#96;class&#96;.&#96;student&#96;.&#96;time&#96;</span><br><span class="line">from &#96;class&#96;.&#96;student&#96;</span><br></pre></td></tr></table></figure>

<p>JOOQ还支持多个Schema的动态替换，以及表名的动态替换，详见<a target="_blank" rel="noopener" href="http://www.jooq.org/doc/latest/manual/sql-building/dsl-context/runtime-schema-mapping/">Runtime schema mapping</a></p>
<h3 id="复用数据库实例"><a href="#复用数据库实例" class="headerlink" title="复用数据库实例"></a>复用数据库实例</h3><p>因为JOOQ的SQL是带有Schema名称的，所以对同一个IP实例中的不同数据库，JOOQ可以方便的支持查询。</p>
<p>这在当多个数据库共用一个数据库实例的时候，很有用，可以复用数据源配置，从而不需要为每一个库创建一个连接池，减少数据库连接资源的占用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataSource &#x3D; ImmutableMap.&lt;String, HikariDataSource&gt;builder()</span><br><span class="line">        .put(&quot;DATABASE1&quot;, datasources1)</span><br><span class="line">        .put(&quot;DATABASE2&quot;, datasources1).build();</span><br></pre></td></tr></table></figure>

<h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><ul>
<li><p>Spring： <a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual-single-page/#jooq-with-spring">http://www.jooq.org/doc/3.8/manual-single-page/#jooq-with-spring</a></p>
</li>
<li><p>JOOQ：<a target="_blank" rel="noopener" href="https://github.com/jOOQ/jOOQ/tree/master/jOOQ-examples/jOOQ-spring-guice-example">https://github.com/jOOQ/jOOQ/tree/master/jOOQ-examples/jOOQ-spring-guice-example</a></p>
</li>
</ul>
<h3 id="其他常用操作：Batch、Curser、Transaction"><a href="#其他常用操作：Batch、Curser、Transaction" class="headerlink" title="其他常用操作：Batch、Curser、Transaction"></a>其他常用操作：Batch、Curser、Transaction</h3><ul>
<li>Batch： <a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual/sql-execution/batch-execution/">http://www.jooq.org/doc/3.8/manual/sql-execution/batch-execution/</a></li>
<li>游标 Curser： <a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual/sql-execution/fetching/lazy-fetching/">http://www.jooq.org/doc/3.8/manual/sql-execution/fetching/lazy-fetching/</a></li>
<li>事务： <a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual-single-page/#transaction-management">http://www.jooq.org/doc/3.8/manual-single-page/#transaction-management</a></li>
</ul>
<h3 id="其它运行时配置"><a href="#其它运行时配置" class="headerlink" title="其它运行时配置"></a>其它运行时配置</h3><p>JOOQ将一些不常用的配置，放在Settings对象类管理，例如</p>
<ul>
<li>是否使用乐观锁</li>
<li>是否打印JOOQ的SQL日志</li>
</ul>
<p>具体可以参考<a target="_blank" rel="noopener" href="http://www.jooq.org/doc/3.8/manual/sql-building/dsl-context/custom-settings/">JOOQ文档</a></p>


<div class="article-footer fs14"><section id="license"><div class="header"><span>License</span></div><div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap" id="read-next"><section class="header cap theme"><span>READ NEXT</span></section><section class="body"><div class="post-title h2"><a href="/2020/02/14/Google%20Java%20%E7%BC%96%E7%A8%8B%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97%EF%BC%88%E4%B8%AD%E6%96%87%EF%BC%89/">Google Java编程风格规范（中文）</a></div><div class="post-title fs14"><a href="/2020/03/28/%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD%E6%B1%87%E6%80%BB/">or prev: 专业术语汇总</a></div></section></div>








      
<footer class="page-footer fs12"><hr><div><p>All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</p>
<p>This site was deployed by <a href="http://example.com/">@John Doe</a> using <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.1.0">Stellar</a>.</p>
</div></footer>

      <div class='float-panel mobile-only' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" viewBox="0 0 1228 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2849"><path d="M0 0m97.390199 0l973.901995 0q97.390199 0 97.390199 97.390199l0 0q0 97.390199-97.390199 97.3902l-973.901995 0q-97.390199 0-97.390199-97.3902l0 0q0-97.390199 97.390199-97.390199Z" p-id="2850"></path><path d="M0 389.560798m97.390199 0l973.901995 0q97.390199 0 97.390199 97.390199l0 0q0 97.390199-97.390199 97.3902l-973.901995 0q-97.390199 0-97.390199-97.3902l0 0q0-97.390199 97.390199-97.390199Z" p-id="2851"></path><path d="M0 779.121596m97.390199 0l973.901995 0q97.390199 0 97.390199 97.390199l0 0q0 97.390199-97.390199 97.390199l-973.901995 0q-97.390199 0-97.390199-97.390199l0 0q0-97.390199 97.390199-97.390199Z" p-id="2852"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script')
      script.src = src
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.1.0';
  stellar.config = {
    date_suffix: {
      just: 'Just',
      min: 'minutes ago',
      hour: 'hours ago',
      day: 'days ago',
      month: 'months ago',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js',
    sitesjs: '/js/plugins/sites.js',
    friendsjs: '/js/plugins/friends.js',
  };

  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper/swiper-bundle.min.css","js":"https://unpkg.com/swiper/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://cdn.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
